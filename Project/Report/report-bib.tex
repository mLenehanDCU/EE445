% !TEX TS-program = xelatex
% !TEX encoding = UTF-8 Unicode

% -----------------
% START OF PREAMBLE
% -----------------
\documentclass[11pt,a4paper,headinclude=false,footinclude=false]{scrreprt}
\usepackage[a4paper,top=2cm,bottom=2cm,left=3cm,right=3cm]{geometry}

% Commands
\newcommand{\HRule}{\rule{\linewidth}{0.5mm}}


% Packages
\usepackage{fontspec}
\usepackage{eurosym}
\usepackage{amssymb}
\usepackage{mathtools}
\usepackage{upquote}
\usepackage{microtype}
%\usepackage{polyglossia}
\usepackage{longtable,booktabs}
\usepackage{graphicx}
\usepackage{grffile}
\usepackage{ulem}[normalem]
\usepackage{cite}
\usepackage{hyperref}[setpagesize=false,
            unicode=false,
            colorlinks=true,
            urlcolor=blue,
	    linkcolor=black]
\usepackage{float}
\usepackage{tabu}
\usepackage{gensymb}
\usepackage{listings}


% Polyglossia settings
%\setmainlanguage{english} % or danish
%\addto\captionsenglish{%
%  \renewcommand{\contentsname}{Table of Contents}
%}


% Required for syntax highlighting



% Don't let images overflow the page
% Can still explicit set width/height/options for an image
\makeatletter
\def\maxwidth{\ifdim\Gin@nat@width>\linewidth\linewidth\else\Gin@nat@width\fi}
\def\maxheight{\ifdim\Gin@nat@height>\textheight\textheight\else\Gin@nat@height\fi}
\makeatother
\setkeys{Gin}{width=\maxwidth,height=\maxheight,keepaspectratio}


% Make links footnotes instead of hotlinks
\renewcommand{\href}[2]{#2\footnote{\url{#1}}}


% Avoid problems with \sout in headers with hyperref:
\pdfstringdefDisableCommands{\renewcommand{\sout}{}}


% No paragraph indentation
% and set space between paragraphs
\setlength{\parindent}{0pt}
\setlength{\parskip}{1em}
\setlength{\emergencystretch}{3em} % Prevent overfull lines
\renewcommand{\baselinestretch}{1.0}
\pagestyle{plain}
\pagenumbering{arabic}

% -----------------
%  END OF PREAMBLE
% -----------------
\begin{document}


\input{CoverSheet/cover}

% Chapter: 0, section: 1, subsection: 2 etc
\setcounter{secnumdepth}{1}
\setcounter{tocdepth}{1}
\tableofcontents
\listoftables
\listoffigures
%\end{document}
\hypertarget{introduction}{%
\chapter{Introduction}\label{introduction}}

\hypertarget{aims}{%
\section{Aims}\label{aims}}

The aim of this project is to implement a connected ECG sensing system,
utilising the Texas Instruments MSP432 Microcontroller, and IoT
analytics platform ThingSpeak. The system must take heart rate
measurements, via a designed bioamplifier circuit using the standard
lead configurations, using the MSP432 Microcontroller. These
measurements must then be transmit to ThingSpeak via a HTTP POST
command, at which point they can be analysed using MATLAB scripts on
ThingSpeak. Finally, results must be compared to that of another group.

This project aims to improve the students familiarity with bioamplifier
circuits, measurements of biopotential values, and with connected
services, in the ThingSpeak implementation.

\hypertarget{hardware}{%
\chapter{Hardware}\label{hardware}}

\hypertarget{components}{%
\section{Components}\label{components}}

\hypertarget{amplifier-design}{%
\section{Amplifier Design}\label{amplifier-design}}

\hypertarget{software}{%
\chapter{Software}\label{software}}

There are threen main aspects to the software portion of this project.
These are the ECG Sampling, the transfer of sampled data to ThingSpeak,
and the MATLAB analysis of the data available on ThingSpeak.

\hypertarget{ecg-sampling}{%
\section{ECG Sampling}\label{ecg-sampling}}

The ECG sampling code implementaion, as used within this project, was
performed at a frequecny of 50Hz (one sample every 20ms). This frequency
was chosen in part due to limitations imposed by ThingSpeak, which could
not allow for a higher frequency to be chosen for single data entries.

In order to take measurements from the bioamplifier circuit, an input
pin must first be defined. An integer variable must be defined in order
to store the measured value.

\lstset{
    caption=Analog Input Pin Definition,
    basicstyle=\footnotesize, frame=tb,
    xleftmargin=.2\textwidth, xrightmargin=.2\textwidth
}
\begin{lstlisting}[language=C]
int AnalogPin = A6; //P4.7
int reading = 0;
\end{lstlisting}

In order to take the reading, the analogRead() method must be called.
This method allows the MSP to read in analog values from 0 to 5V,
assigning them a value between 0 and 1023. An if statement is used to
ensure that the readings are taken at the appropriate timing.

\lstset{
    caption=Analog Read,
    basicstyle=\footnotesize, frame=tb,
    xleftmargin=.1\textwidth, xrightmargin=.1\textwidth
}
\begin{lstlisting}[language=C]
if(millis() - lastReadingTime > updateThingSpeakInterval){
    reading = analogRead(AnalogPin);
}
\end{lstlisting}

\hypertarget{thingspeak-integration}{%
\section{ThingSpeak Integration}\label{thingspeak-integration}}

ThingSpeak integration is performed using the ThingSpeakClient.ino code
example found in the Energia git repository\cite{thingino}. This example
works much in the same way as the Energia WifiWebClient example code,
however, it has code included to update ThingSpeak input fields, in the
required format.

In order to correctly utilize this code, the ThingSpeak write API key
must be included in the code, as a String value. An update interval
value is used in order to set how often data is sent to ThingSpeak from
the client. For this implementation, this has been set to 20ms, as this
was the lowest accepted value.

\lstset{
    caption=ThingSpeakClient.ino write API key and update interval,
    basicstyle=\footnotesize, frame=tb,
    xleftmargin=.1\textwidth, xrightmargin=.1\textwidth
}
\begin{lstlisting}[language=C]
String writeAPIkey = ""; //Enter channel's write API key
                        //between the ""
const int updateThingSpeakInterval = 20; //20ms time interval
\end{lstlisting}

The startWifi() method is called from within the codes setup, and
connects to the network of the input ssid and password, printing a
success message to the serial monitor once connected.

\lstset{
    caption=ThingSpeakClient.ino startWifi(),
    basicstyle=\footnotesize, frame=tb,
    xleftmargin=.1\textwidth, xrightmargin=.1\textwidth
}
\begin{lstlisting}[language=C]
char ssid[] = ""; // your network SSID (name)
char pass[] = ""; // your network password
WiFiClient client;
void startWiFi(){
    WiFi.disconnect();
    client.stop();
    ...
    if(WiFi.begin(ssid, pass) == 0){
    ...
    } else {
    Serial.println("LaunchPad connected to network using DHCP");
    ...
    }
}
\end{lstlisting}

\hypertarget{matlab-script}{%
\section{MATLAB Script}\label{matlab-script}}
\bibliography{References/biblio}{}
\bibliographystyle{IEEEtran}
\end{document}
